# HTTPS(Hyper-Text Transfer Protocol over Secure socket layer)
  - HTTP의 단점을 보완한 통신 프로토콜이다.
  - 기존의 HTTP는 클라이언트의 요청을 별다른 암호화 없이 서버에 전달하였다.
  - 때문에 제3자가 인터넷 상에서 해당 요청을 탈취하여 정보가 새어나갈 위험에 노출되어 있었다.
  - 이를 방지하기 위해 HTTP에 SSL 프로토콜을 결합한 형태가 바로 HTTPS프로토콜이다.

## SSL(또는 TLS)
  - SSL은 Secure Sockets Layer의 약자로 "SSL은 웹사이트와 브라우저 사이(또는 두 서버 사이)에 전송되는 데이터를 암호화하여 인터넷 연결을 보호하기 위한 표준 기술입니다. 이 기술은 해커가 개인 데이터나 금융 데이터 등의 전송되는 정보를 보거나 훔치는 것을 방지합니다."(출처 :https://www.digicert.com/kr/what-is-ssl-tls-and-https )
  - TLS란 전송 계층 보안(Transport Layer Security)으로 SSL의 향상된, 더욱 안전한 버전. SSL이 더욱 일반적인 용어이기 때문에 DigiCert는 보안 인증서를 여전히 SSL로 언급하지만 DigiCert에서 SSL을 구입하면 가장 신뢰할 수 있는 최신 TLS 인증서를 얻을 수 있다.
  - TLS 프로토콜은 3가지 기준을 가진다.
    1. 암호화: 제3자로 부터 데이터를 숨긴다.
    2. 인증: 데이터 통신 당사자간의 상호 신분을 보장한다.
    3. 무결성: 데이터 위조 및 변조를 점검한다.

#### CA(Certificate Authority)
  - CA란 뭐하는 사람이길래 인증서를 발급해줄까?
  - CA는 HTTPS 통신에서 서버의 신원을 클라이언트에게 보장 할 수 있도록 TLS 프로토콜을 따른 인증서를 발급해줄 수 있는 인증기관이다.  
  - 이 인증서를 통해 클-서 가 서로를 신뢰하고 데이터를 전달할 수 있기에 CA는 높은 수준의 인증 기준을 충족시킬 수 있는 기관만 될 수 있다.
  - 우리가 사용하는 크롬, Edge, 파이어폭스 등의 웹 브라우저는 공인된 CA들의 목록을 자체적으로 자신들의 어플리케이션에 보유하고 있으며 서버가 보내오는 인증서를 검증할 때 해당 목록을 통해 인증서를 신뢰할 수 있는지를 판단한다.
  - CA에는 목록이 존재할 정도로 여러 기관이 존재하는데 단순히 인증기관이 많은 것을 넘어 기관마다 계층이 나뉘어져 있고 서로 상호작용하면서 인증서를 만든다.

##### CA의 계층구조
  - CA도 인증 단계에 따라 intermediate, Root 단계로 나뉘어진다.
  - 서버-intermediate CA -Root CA 순서대로 단계를 거져 인증서를 만들어 처리하고 이를 거꾸로 타고가 서버에게 인증서를 제공한다.
   <img src="../images/CA 인증절차.png" width="600" height="300"></img><br/>
   - 서버가 ICA(intermediate CA)에게 자신의 여러 정보와 서버의 공개키를 제공하면 ICA는 이를 자신의 개인키로 암호화(서명이라고도 함)한다.
   - ICA가 서명한 인증서를 다시 Root CA에게 보내어 Root가 ICA 정보와 ICA 공개키를 자신의 개인키로 암호화한다.
   - 마지막으로 Root CA는 자신의 공개키를 담은 최종 인증서를 만들고(즉 암호화 or 서명) 이를 서버에게 제공한다.
   - 이 과정에서 ICA는 여러 단계로 여러기관이 존재할 수 있지만 Root CA는 한 곳 뿐이다.
   - 이러한 과정을 통해 나온 인증서에는 여러 CA가 나열되어있을 것이고 이것을 Certificate Chain(인증서 체인이라고 한다.)
    <img src="../images/인증서체인.png" width="600" height="300"></img><br/>
###### Certificate Chain의 필요성
  - 이렇게 여러 단계로 인증 단계를 나누는 이유는 인증서가 중간에 탈취 당해 위조된 인증서를 받았을 경우에 위험을 방지하는데 용이하기 때문이다.
  - 브라우저는 각 공인된 CA의 목록과 공개키를 가지고 있기에 인증서 위조여부를 판단할 수 있다.
  - 또한 ICA의 개인키가 유출됬을 지라도 다른 ICA 혹은 Root CA의 인증서로 대신 진위여부를 가릴 수 있기 때문.

### TLS의 작동방식
  - 우선 서버에 TLS 인증서가 설치되어 있어야 한다.(SSL인증서라고도 한다.)
  - CA가 서버에게(정확히는 어떤 서비스를 위해 서버를 보유하고 있는 도메인 소유자 혹은 비즈니스) TLS 인증서를 발행한다.
  - 이 인증서에는 서버가 가진 공개키+ 서버가 누구인지를 확인시켜줄 신분증같은 정보가 담겨져 있다.
    1. 첫번째로 클라이언트 - 서버간의 HandShake를 실시한다.
      - HandShake란 TLS(SSL)암호화를 통한 통신 세션을 실행하는 과정을 뜻한다.
      1) 클라이언트가 임의의 값과 자신이 사용가능한 암호화 방식들 2가지를 모아 서버에 전달한다(이를 클라이언트 Hello라고 한다.)
        - 만약 이전에 서로 통신한 적이 있다면 HandShake를 넘기고 바로 기존에 갖고 있던 세션 ID를 서버에 보내 인증을 한다.
      2) 서버가 클라이언트 Hello의 응답으로 서버의 TLS(SSL)인증서, 서버에서 사용가능한 암호방식들, 임의값(클라이언트 임의값과 다른 값)을 모아 클라이언트에게 전달한다.
      3) 그럼 클라이언트는 서버가 보낸 데이터 중에서 우선 인증서의 CA를 확인하는데, 적혀 있는 CA의 공개키를 가져와 인증서를 검토한다. 인증서가 검증된다면 이제는 서버를 신뢰할 수 있게 된다.
    2. HandShake를 통해 클라이언트가 서버를 신뢰할 수 있게 되었다. 이제 클라이언트는 서버가 보낸 임의값+자신이 만든 임의값을 혼합해 새로운 값을 만드는데 이를 pre-master-secret이라고 부른다.**pre-master-secret은 이제 클-서가 서로 데이터를 주고 받을 수 있는 공통키(대칭키 방식으로 사용할)가 되기에 절대로 탈취되서는 안된다.**
    3. 이 공통키인 pre-master-secret을 서버에게 전달하는 방법은 아까 HandShake 중에 서버에게 받은 서버의 공개키를 활용하는 것이다. 서버의 공개키로 pre-master-secret을 암호화해 서버에게 전달한다.

    4. 공개키(비대칭키 방식)로 암호화 되었기에 이것이 탈취되더라도 서버의 개인키(비밀키라는 용어가 더 잘 와 닿는다)가 유출되지 않는 이상 안전하다. 서버는 암호화된 값을 자신의 개인키로 복호화 하면 된다. 이로서 pre-master-secret은 master-secret이 된다..

    5. 이렇게 클라이언트와 서버가 서로 동일한 공개키를 고유할 수 있게 된 것이다. 마지막으로 이 master-secret키를 가지고 서버는 Session 키를 생성한다
    6. 따라서 해당 클라이언트가 Authentication(인증)을 마치고 나면 이 Sesion Key를 Response와 함께 쿠키에 담아 제공하고 다음 Request시 클라이언트는 쿠키에 이 세션키를 담아 전달한다. 최종적으로 이 Session Key를 가지고 서로 데이터를 주고 받게된다.
    7. 서로 더이상 주고 받을 데이터가 없을 때는 클라이언트가 LogOut을 하고 서버의 Session key로 폐기된다.


## HTTPS가 필수인 이유

  1. HTTPS 설명에서 처럼 보안적 측면의 강화를 위해 HTTPS가 도입되었다. 요즘처럼 개인정보의 중요성이 중요해지는 분위기에서 HTTP 만을 사용한 어플리케이션은 금방 외부 칩입으로부터 피해를 입을 가능성이 커지기 때문.
    - HTTPS는 TLS를 도입하였다. TLS에서 설명한 것처럼 SSL보다 보안적으로 우수하다는 점 뿐만 아니라 데이터 손실또한 방지해 준다. 또한 데이터가 자칫 위조되거나 전송 과정에서 손실될 우려가 적기 때문

  2. 검색엔진에 최적화가 되어있다.
    - 보안 뿐만 아니라 검색엔진 최적화(SEO )의 혜택을 누릴 수 있게 된다.
    - 2014년에 구글은 웹 보안 강화정책으로 모든 사이트에 HTTPS를 도입할 것을 발표했다. HTTP만 준수하는 웹에 경우 검색결과에 나오는 것이 제한 되거 SSL(TLS)인증서가 없는 서버 접속시 경고창을 띄우는 등 제재를 가한 것이다.
    참고 : https://it.donga.com/25915/

  3. 모바일 최적화에 유리하다.
    - 가속화된 모바일 페이지(AMP, Accelerated Mobile Pages)라는 개념이 있다. 이는 일반 PC기반의 웹을 모바일 환경에서도 적용하여 빠르게 로딩을 하기 위한 방법으로 구글에서 만들어 냈다. 쉽게 말해 HTML에서 불필요한 부분을 제거한 페이지를 로딩하게 하는 것이다.
    - PC보다 모바일 이용자가 더 많아지기에 이러한 환경은 비즈니스적으로 유리하기에 HTTPS 도입은 필수적이라 할 수 있다.




  출처: https://aws-hyoh.tistory.com/59  
  https://www.digicert.com/kr/what-is-ssl-tls-and-https  
  https://brunch.co.kr/@sangjinkang/47
  https://m.blog.naver.com/alice_k106/221468341565
  https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake/
  https://yozm.wishket.com/magazine/detail/130/
